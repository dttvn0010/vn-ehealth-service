	<component>
	  <section>
	    <templateId root="2.16.840.1.113883.3.6000.4.2"/>
	    <code code="46240-8" 
	    	  codeSystem="2.16.840.1.113883.6.1" 
	    	  codeSystemName="LOINC" 
	    	  displayName="History of encounters"
	    	  />
	    	  
	    <title>QUẢN LÝ NGƯỜI BỆNH</title>
	    <text>
	    	<table>
	    		<tbody>
		    		<tr>
		    			<td>Ngày vào viện:</td>
		    			<td>$!hsba.quanLyNguoiBenh.ngayGioVaoVien</td>
		    		</tr>
		    		<tr>
		    			<td>Ngày ra viện:</td>
		    			<td>$!hsba.quanLyNguoiBenh.ngayGioRaVien</td>
		    		</tr>
		    		<tr>
		    			<td>Trực tiếp vào:</td>
		    			<td>$!hsba.quanLyNguoiBenh.dmNoiTrucTiepVao.ten</td>
		    		</tr>
		    		<tr>
		    			<td>Nơi giới thiệu:</td>
		    			<td>$!hsba.quanLyNguoiBenh.dmNoiGioiThieu.ten</td>
		    		</tr>
		    		<tr>
		    			<td>Chuyển viện:</td>
		    			<td>$!hsba.quanLyNguoiBenh.dmLoaiChuyenVien.ten</td>
		    		</tr>
		    		<tr>
		    			<td>Ra viện:</td>
		    			<td>$!hsba.quanLyNguoiBenh.dmLoaiRaVien.ten</td>
		    		</tr>
	    		</tbody>
	    	</table>
	    </text>
	    <entry>
	      <encounter classCode="ENC" moodCode="EVN">
	        <templateId root="2.16.840.1.113883.3.6000.5.10"/>
	        
	        #set($dm=$!hsba.dmLoaiBenhAn)         
          	<code code="$!dm.ma"
	         	  codeSystem="2.16.840.1.113883.3.6000.2.1"
	         	  displayName="$!dm.ten"/>
         
	        <effectiveTime>
	          <low value="$!utils.formatDate($!hsba.quanLyNguoiBenh.ngayGioVaoVien)"/>
	          <high value="$!utils.formatDate($!hsba.quanLyNguoiBenh.ngayGioRaVien)"/>
	        </effectiveTime>
	        
	        <performer>
	          <assignedEntity>
	            <templateId root="2.16.840.1.113883.3.6000.5.11.1"/>
	            <id root="$!utils.randomUUID()"/>
	            
	            <code code="421841007" 
	            	  codeSystem="2.16.840.1.113883.6.96" 
	            	  codeSystemName="SNOMED CT" 
	            	  displayName="Admitting physician"
	            	  />
	            	  
	            <assignedPerson>
	              <name>$!hsba.quanLyNguoiBenh.bacSiKham.ten</name>
	            </assignedPerson>
	          </assignedEntity>
	        </performer>
	        
	        <performer>
	          <assignedEntity>
	            <templateId root="2.16.840.1.113883.3.6000.5.11.2"/>
	            <id root="$!utils.randomUUID()"/>
	            
	            <code code="405279007" 
	                  codeSystem="2.16.840.1.113883.6.96" 
	                  codeSystemName="SNOMED CT" 
	                  displayName="Attending physician"
	                  />
	                  
	            <assignedPerson>
	              <name>$!hsba.quanLyNguoiBenh.bacSiChoRaVien.ten</name>
	            </assignedPerson>
	          </assignedEntity>
	        </performer>
	        
	        <participant typeCode="LOC">
	          <participantRole classCode="SDLOC">
	            <templateId root="2.16.840.1.113883.3.6000.5.12"/>
	                 
	            #set($dm=$!hsba.quanLyNguoiBenh.dmNoiTrucTiepVao)         
	          	<code code="$!dm.ma"
		         	  codeSystem="2.16.840.1.113883.3.6000.2.2"
		         	  displayName="$!dm.ten"/>       
	            	              	  
	          </participantRole>
	        </participant>
	        
	        <participant typeCode="REFB">
	          <participantRole classCode="SDLOC">
	            <templateId root="2.16.840.1.113883.3.6000.5.13"/>
	            
	            #set($dm=$!hsba.quanLyNguoiBenh.dmNoiGioiThieu)         
	          	<code code="$!dm.ma"
		         	  codeSystem="2.16.840.1.113883.3.6000.2.3"
		         	  displayName="$!dm.ten"/>  
		          			
	          </participantRole>
	        </participant>       
	        
	        <entryRelationship typeCode="COMP">
	          <act classCode="ACT" moodCode="EVN">
	            <templateId root="2.16.840.1.113883.3.6000.5.8"/>
	            <id root="$!utils.randomUUID()"/>
	            
	            #set($dm=$!hsba.quanLyNguoiBenh.dmLoaiChuyenVien)         
	          	<code code="$!dm.ma"
		         	  codeSystem="2.16.840.1.113883.3.6000.2.5"
		         	  displayName="$!dm.ten"/>  
		          				                  				
	          </act>
	        </entryRelationship>
	        
	        <entryRelationship typeCode="COMP">
	          <act classCode="ACT" moodCode="EVN">
	            <templateId root="2.16.840.1.113883.3.6000.5.9"/>
	            <id root="$!utils.randomUUID()"/>
	            
	            #set($dm=$!hsba.quanLyNguoiBenh.dmLoaiRaVien)         
	          	<code code="$!dm.ma"
		         	  codeSystem="2.16.840.1.113883.3.6000.2.5"
		         	  displayName="$!dm.ten"/>  
		         	
	          </act>
	        </entryRelationship>
	        
	        <entryRelationship typeCode="COMP">
	          <supply classCode="SPLY" moodCode="EVN">
	            <code xsi:type="CS" code="TSNDT"/>
	            $!utils.createText($!hsba.quanLyNguoiBenh.tongSoNgayDieuTri)
	          </supply>
	        </entryRelationship>
	        
	        <entryRelationship typeCode="COMP">
	          <observation classCode="OBS" moodCode="EVN">
	            <templateId root="2.16.840.1.113883.3.6000.5.10.2"/>
	            
	            <code codeSystem="2.16.840.1.113883.3.6000.6" 
	            	  displayName="Vào viện do bệnh này lần thứ"
	            	  />
	            
	            $!utils.createText($!hsba.quanLyNguoiBenh.vaoVienLanThu)
	          </observation>
	        </entryRelationship>
	      </encounter>
	    </entry>
	
		#foreach( $vk in $hsba.dsVaoKhoa )    
		    <entry>
		      <encounter classCode="ENC" moodCode="EVN">
		        <templateId root="2.16.840.1.113883.3.6000.5.15"/>
		        <id root="$utils.randomUUID()" />
		        
		        <code code="305349003" 
		        	  codeSystem="2.16.840.1.113883.6.96" 
		        	  codeSystemName="SNOMED CT" 
		        	  displayName="Admission to department"/>
		        	  
		        <effectiveTime>
		          <low value="$!utils.formatDate($!vk.ngayGioVaoKhoa)"/>
		          <high value="$!utils.formatDate($!vk.ngayKetThucDieuTri)"/>
		        </effectiveTime>
		        
		        <performer>
		          <assignedEntity>
		            <id root="$utils.randomUUID()"/>
		            <assignedPerson>
		              <name>$!vk.bacSiDieuTri.ten</name>
		            </assignedPerson>
		          </assignedEntity>
		        </performer>
		        
		        <participant typeCode="LOC">
		          <participantRole classCode="SDLOC">
		            <templateId root="2.16.840.1.113883.3.6000.5.16"/>
		            <playingEntity classCode="PLC">
		              <code code="$!vk.dmKhoaDieuTri.ma"/>
		              <name>$!vk.dmKhoaDieuTri.ten</name>
		            </playingEntity>
		          </participantRole>
		        </participant>
		        
		        <entryRelationship typeCode="COMP">
		          <observation classCode="OBS" moodCode="EVN">
		            <templateId root="2.16.840.1.113883.3.6000.5.15.1"/>
		            
		            <code codeSystem="2.16.840.1.113883.3.6000.6" 
		            	  displayName="Số phòng, số giường"/>
		            	  
		            $!utils.createText($!vk.phong)
		            <value xsi:type="ST">$!vk.phong - $!vk.giuong</value>
		          </observation>
		        </entryRelationship>
		        
		        <entryRelationship typeCode="COMP">
		          <observation classCode="OBS" moodCode="EVN">
		            <templateId root="2.16.840.1.113883.3.6000.5.15.2"/>
		            
		            <code codeSystem="2.16.840.1.113883.3.6000.6" 
		            	  displayName="Số ngày điều trị"/>
		            
		            $!utils.createText($!vk.soNgayDieuTri)
		          </observation>
		        </entryRelationship>
		      </encounter>
		    </entry>
		#end
	  </section>
	</component>